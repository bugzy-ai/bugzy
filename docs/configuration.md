# Configuration Guide

This guide covers how to configure Bugzy for your project, including subagent setup, environment variables, and reconfiguration.

## Configuration File Structure

Bugzy stores its configuration in `.bugzy/config.json`. **Do not edit this file manually** - use `bugzy setup` instead.

### Example Configuration

```json
{
  "version": "1.0.0",
  "project": {
    "name": "my-web-app"
  },
  "subagents": {
    "team-communicator": "slack",
    "documentation-researcher": "notion",
    "test-runner": "playwright"
  }
}
```

### Fields

| Field | Description | Type |
|-------|-------------|------|
| `version` | Bugzy configuration version | string |
| `project.name` | Project name (auto-detected from directory) | string |
| `subagents` | Map of subagent roles to integrations | object |

## Subagent Configuration

Subagents are specialized AI agents that provide specific capabilities to your tasks.

### Available Subagents

#### Test Runner (Required)

**Role**: `test-runner`

Executes automated tests in your application.

**Integrations**:
- `playwright` - Browser automation with Playwright (recommended)
- `puppeteer` - Browser automation with Puppeteer

**Configuration**:
```json
{
  "subagents": {
    "test-runner": "playwright"
  }
}
```

**Required Environment Variables**: None (runs locally)

---

#### Team Communicator (Optional)

**Role**: `team-communicator`

Sends notifications and messages to your team.

**Integrations**:
- `slack` - Send messages to Slack channels

**Configuration**:
```json
{
  "subagents": {
    "team-communicator": "slack"
  }
}
```

**Required Environment Variables**:
```bash
SLACK_BOT_TOKEN=xoxb-your-token-here
```

---

#### Documentation Researcher (Optional)

**Role**: `documentation-researcher`

Searches and retrieves documentation from your knowledge base.

**Integrations**:
- `notion` - Search Notion pages and databases
- `confluence` - Search Confluence spaces and pages

**Configuration**:
```json
{
  "subagents": {
    "documentation-researcher": "notion"
  }
}
```

**Required Environment Variables**:

For Notion:
```bash
NOTION_TOKEN=secret_your-token-here
```

For Confluence:
```bash
CONFLUENCE_URL=https://your-domain.atlassian.net
CONFLUENCE_EMAIL=your-email@company.com
CONFLUENCE_API_TOKEN=your-api-token
```

---

#### Issue Tracker (Optional)

**Role**: `issue-tracker`

Creates and manages issues/bugs in your tracking system.

**Integrations**:
- `linear` - Create issues in Linear
- `jira` - Create issues in Jira
- `notion` - Create issues in Notion database
- `slack` - Post issues to Slack channel

**Configuration**:
```json
{
  "subagents": {
    "issue-tracker": "linear"
  }
}
```

**Required Environment Variables**:

For Linear:
```bash
LINEAR_API_KEY=lin_api_your-key-here
LINEAR_TEAM_ID=your-team-id
```

For Jira:
```bash
JIRA_HOST=your-domain.atlassian.net
JIRA_EMAIL=your-email@company.com
JIRA_API_TOKEN=your-api-token
JIRA_PROJECT_KEY=PROJ
```

For Notion:
```bash
NOTION_TOKEN=secret_your-token-here
NOTION_DATABASE_ID=your-database-id
```

For Slack:
```bash
SLACK_BOT_TOKEN=xoxb-your-token-here
SLACK_CHANNEL_ID=C01234567
```

## Environment Variables

Bugzy uses environment variables for API tokens and configuration. Variables are loaded in this priority order:

1. `.env.local` (highest priority, gitignored)
2. `.env` (team defaults or personal secrets, gitignored)
3. `.env.testdata` (template only, committed to git)

### Managing Secrets

#### Initial Setup

After running `bugzy setup`, an `.env.testdata` file is created:

```bash
# Copy the example
cp .env.testdata .env

# Edit with your secrets
vim .env
```

#### Required vs Optional Variables

- **Required**: Variables for configured subagents (Bugzy will validate before starting)
- **Optional**: Test data and application configuration

#### Example .env File

```bash
# ============================================
# MCP Server Secrets
# ============================================

# Slack MCP Server
SLACK_BOT_TOKEN=xoxb-1234567890-1234567890-abcdefghijklmnopqrstuvwx

# Notion MCP Server
NOTION_TOKEN=secret_abcdefghijklmnopqrstuvwxyz1234567890

# Linear MCP Server
LINEAR_API_KEY=lin_api_1234567890abcdefghijklmnopqrstuvwxyz

# ============================================
# Test Configuration
# ============================================

# Application under test
TEST_BASE_URL=http://localhost:3000

# Test user credentials
TEST_USER_EMAIL=test@example.com
TEST_USER_PASSWORD=SecurePassword123!

# Test timeouts
TEST_TIMEOUT=30000
TEST_HEADLESS=false
```

### Security Best Practices

1. **Never commit `.env` or `.env.local`** - They contain secrets
2. **Use `.env.testdata`** - Commit this as a template for your team
3. **Rotate tokens regularly** - Update API tokens periodically
4. **Use separate tokens per environment** - Dev, staging, prod should have different tokens
5. **Limit token permissions** - Grant only necessary scopes

## Reconfiguration

Need to change your subagent configuration? Run:

```bash
bugzy setup
```

The setup command detects existing configuration and allows you to:
- Keep current subagents
- Change to different integrations
- Add new subagents
- Remove subagents

### Example Reconfiguration Flow

```bash
$ bugzy setup

üêõ Bugzy OSS - Reconfigure

Current configuration:
  ‚Ä¢ team-communicator: slack
  ‚Ä¢ documentation-researcher: notion
  ‚Ä¢ test-runner: playwright

? Change team-communicator? (currently: slack)
‚ùØ Keep slack
  Change to different integration
  Remove

? Change documentation-researcher? (currently: notion)
  Keep notion
‚ùØ Change to different integration
  Remove

? Select new integration for documentation-researcher:
‚ùØ Confluence
  Notion

? Add issue-tracker? (currently: not configured)
‚ùØ Linear
  Jira
  Notion
  Slack
  None (skip)

Updating configuration...
‚úì Updated .bugzy/config.json

Regenerating task commands...
‚úì Regenerated 8 commands in .claude/commands/

...
```

### What Gets Regenerated

When you run `bugzy setup`, these files are regenerated:
- All task commands in `.claude/commands/`
- All subagent configs in `.claude/agents/`
- `.mcp.json` with MCP server configurations
- `.env.testdata` with updated required secrets

**Note**: Your actual `.env` file is never modified - you must manually add new secrets.

## MCP Server Configuration

Bugzy automatically generates `.mcp.json` based on your subagent configuration.

### Example MCP Configuration

```json
{
  "mcpServers": {
    "slack": {
      "command": "slack-mcp-server",
      "args": [],
      "env": {
        "SLACK_BOT_TOKEN": "${SLACK_BOT_TOKEN}"
      }
    },
    "playwright": {
      "command": "mcp-server-playwright",
      "args": [
        "--browser", "chromium",
        "--secrets", ".env",
        "--headless",
        "--no-sandbox",
        "--viewport-size", "1280x720"
      ],
      "env": {}
    },
    "notion": {
      "command": "notion-mcp-server",
      "args": [],
      "env": {
        "NOTION_TOKEN": "${NOTION_TOKEN}"
      }
    }
  }
}
```

### MCP Server Installation

MCP servers must be installed separately. Bugzy generates the configuration but doesn't install the servers.

**Installing MCP servers**:

```bash
# Slack
npm install -g @modelcontextprotocol/server-slack

# Playwright
npm install -g @modelcontextprotocol/server-playwright

# Notion
npm install -g @modelcontextprotocol/server-notion
```

## Project Context

Edit `.bugzy/runtime/project-context.md` to provide context to AI agents:

```markdown
# Project Context

## Customer Information
**Customer Name:** Acme Corp
**Primary Contact:** john@acme.com

## Project Information
**Project Name:** Acme E-commerce Platform
**Description:** B2B e-commerce platform for wholesale orders
**Repository:** https://github.com/acme/ecommerce

## Development Process
**Methodology:** Agile
**Sprint Length:** 2 weeks
**Current Sprint:** Sprint 24

## QA Integration
**QA Entry Point:** During development (shift-left)
**Definition of Done:** All tests pass, code reviewed, QA approved
**Sign-off Process:** QA Lead signs off before deployment

## Tools & Systems
**Bug Tracking:** Linear
**Documentation:** Notion
**CI/CD Platform:** GitHub Actions
**Communication:** Slack #engineering channel

## Team Contacts
**Product Owner:** Jane Smith (jane@acme.com)
**Tech Lead:** Bob Johnson (bob@acme.com)
**QA Lead:** Alice Williams (alice@acme.com)

## Notes
- All tests must run in Chrome, Firefox, and Safari
- Payment flow requires PCI compliance testing
- Performance target: <3s page load
```

This context is automatically included in all task prompts, helping AI agents understand your project.

## Advanced Configuration

### Custom Test Templates

Edit `.bugzy/runtime/templates/test-plan-template.md` to customize test plan format:

```markdown
# Test Plan Template

## Executive Summary
[High-level overview]

## Scope
### In Scope
- [Feature 1]
- [Feature 2]

### Out of Scope
- [Feature 3]

## Test Scenarios

### Scenario 1: [Name]
**Priority**: High/Medium/Low
**Objective**: [What are we testing?]

**Test Cases**:
1. [Test case description]
2. [Test case description]

**Expected Results**:
- [Expected outcome]

## Risk Assessment
[Potential risks and mitigation]

## Test Environment
[Environment details]

## Success Criteria
[How to measure test success]
```

## Troubleshooting Configuration

### Configuration Validation Error

```
Error: Invalid configuration format
```

**Solution**: Run `bugzy setup` to recreate a valid configuration.

### Missing Integration

```
Error: Integration 'confluence' not found for role 'documentation-researcher'
```

**Solution**: Check that you're using a supported integration name. Run `bugzy setup` to see available options.

### Secrets Not Loading

```
‚úó Missing required MCP secrets: SLACK_BOT_TOKEN
```

**Solution**:
1. Check that `.env` exists in project root
2. Verify the variable name matches exactly (case-sensitive)
3. Ensure no extra spaces around `=`
4. Restart Bugzy after adding secrets

## Best Practices

1. **Commit `.env.testdata`** - Helps team members know what variables they need
2. **Document custom variables** - Add comments in `.env.testdata` for project-specific variables
3. **Test configuration** - Run `bugzy` without arguments to validate setup before starting work
4. **Keep configuration simple** - Only configure subagents you'll actually use
5. **Update project context** - Keep `.bugzy/runtime/project-context.md` current

## Next Steps

- Learn about [Subagents](./subagents.md)
- Explore [Task Library](./tasks.md)
- Understand [Architecture](./architecture.md)
